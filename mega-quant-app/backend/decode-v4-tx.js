// Decode the V4 transaction
import { AbiCoder } from 'ethers'

const txInput = '0x3593564c000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000069215fbb00000000000000000000000000000000000000000000000000000000000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000160000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000003060c0f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000140000000000000000000000000000000000000000000000000000000000000018000000000000000000000000000000000000000000000000000000000000000c00000000000000000000000004200000000000000000000000000000000000006000000000000000000000000833589fcd6edb6e08f4c7c32d4f71b54bda0291300000000000000000000000000000000000000000000000000000000000001f4000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000005af3107a40000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000420000000000000000000000000000000000000600000000000000000000000000000000000000000000000000005af3107a40000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000833589fcd6edb6e08f4c7c32d4f71b54bda029130000000000000000000000000000000000000000000000000000000000000001'

const abiCoder = AbiCoder.defaultAbiCoder()
const params = '0x' + txInput.slice(10)

const decoded = abiCoder.decode(['bytes', 'bytes[]', 'uint256'], params)
const v4Decoded = abiCoder.decode(['bytes', 'bytes[]'], decoded[1][0])

const swapParams = abiCoder.decode(
  ['tuple(address currency0, address currency1, uint24 fee, int24 tickSpacing, address hooks)', 'bool', 'uint128', 'bytes'],
  v4Decoded[1][0]
)

console.log('Pool Key Fee:', swapParams[0][2])
console.log('Pool Key Tick Spacing:', swapParams[0][3])
console.log('Amount In:', swapParams[2].toString())

const takeParams = abiCoder.decode(['address', 'uint256'], v4Decoded[1][2])
console.log('Min Amount Out:', takeParams[1].toString())
